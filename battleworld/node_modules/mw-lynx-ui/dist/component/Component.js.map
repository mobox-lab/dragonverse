{"version":3,"file":"Component.js","sources":["../../component/Component.ts"],"sourcesContent":["import { Property } from \"../style/Property\";\r\nimport Gtk, { Delegate } from \"gtoolkit\";\r\n\r\nexport abstract class Component {\r\n    protected static create(): Component {\r\n        throw new Error(\"not implemented.\");\r\n    }\r\n\r\n    protected static defaultOption(): unknown {\r\n        throw new Error(\"not implemented.\");\r\n    }\r\n\r\n    private _root: mw.Canvas;\r\n\r\n    protected initRoot(_root?: mw.Canvas): void {\r\n        this._root = _root ?\r\n            _root :\r\n            mw.Canvas.newObject(undefined, \"root\");\r\n        this._root.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n        if (this._root.destroyObject === this._root.constructor.prototype.destroyObject) {\r\n            this._root.destroyObject = () => {\r\n                if (this.renderAnimHandler) {\r\n                    mw.TimeUtil.onEnterFrame.remove(this.renderAnim);\r\n                }\r\n                this.destroy();\r\n                this._root.constructor.prototype.destroyObject.call(this._root);\r\n            };\r\n        }\r\n        if (this.renderAnimHandler) {\r\n            mw.TimeUtil.onEnterFrame.add(this.renderAnim);\r\n        }\r\n    }\r\n\r\n    public get root(): mw.Canvas {\r\n        if (!this._root) this.initRoot();\r\n\r\n        return this._root;\r\n    }\r\n\r\n    public setLayout(option: ComponentOption): this {\r\n        if (this._root) {\r\n            if (option.zOrder !== undefined) this._root.zOrder = option.zOrder;\r\n\r\n            Gtk.setUiSize(this._root, option.size.x, option.size.y);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    protected destroy(): void {\r\n    }\r\n\r\n    public attach(canvas: mw.Canvas | Component): this {\r\n        if (canvas instanceof mw.Canvas) {\r\n            canvas.addChild(this.root);\r\n        } else {\r\n            canvas.root.addChild(this.root);\r\n        }\r\n\r\n        this.onAttach.invoke();\r\n        return this;\r\n    }\r\n\r\n    public detach() {\r\n        this.onDetach.invoke();\r\n        this._root?.removeObject();\r\n    }\r\n\r\n//#region Anim\r\n    private renderAnim: (dt: number) => void = (dt) => {\r\n        if (this._root && this._root.visible) {\r\n            this.renderAnimHandler(dt);\r\n        }\r\n    };\r\n\r\n    protected renderAnimHandler: (dt: number) => void;\r\n//#endregion\r\n\r\n//#region Event\r\n    public onAttach: Delegate.SimpleDelegate<void> = new Delegate.SimpleDelegate<void>().setProtected();\r\n\r\n    public onDetach: Delegate.SimpleDelegate<void> = new Delegate.SimpleDelegate<void>().setProtected();\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n}\r\n\r\nexport interface ComponentOption {\r\n    size?: { x: number, y: number };\r\n\r\n    padding?: Property.Padding;\r\n\r\n    zOrder?: number;\r\n}\r\n\r\n/**\r\n * Extract layout from option.\r\n * @param {ComponentOption} option\r\n * @returns {[\r\n * [number, number],\r\n * [number, number, number, number],\r\n * [number, number]\r\n * ]}\r\n *      [x,y]\r\n *      [pt, pr, pb, pl]\r\n *      [x - pl - pr, y - pt - pb]\r\n */\r\nexport function extractLayoutFromOption(option: ComponentOption): [\r\n    [number, number],\r\n    [number, number, number, number],\r\n    [number, number]] {\r\n    const [x, y] = [option.size.x, option.size.y];\r\n    const [pt, pr, pb, pl] = [option.padding.top ?? 0,\r\n        option.padding.right ?? 0,\r\n        option.padding.bottom ?? 0,\r\n        option.padding.left ?? 0,\r\n    ];\r\n    return [\r\n        [x, y],\r\n        [pt, pr, pb, pl],\r\n        [x - pl - pr, y - pt - pb]];\r\n}\r\n\r\n/**\r\n * Override layout option.\r\n * @param {ComponentOption} self\r\n * @param {ComponentOption} from\r\n * @returns {ComponentOption}\r\n */\r\nexport function overrideOption(self: ComponentOption,\r\n                               from: ComponentOption): ComponentOption {\r\n    if (self === from) return;\r\n    if (from?.zOrder !== undefined) self.zOrder = from.zOrder;\r\n    if (from?.size !== undefined) {\r\n        if (from.size.x !== undefined) self.size.x = from.size.x;\r\n        if (from.size.y !== undefined) self.size.y = from.size.y;\r\n    }\r\n    if (from?.padding) {\r\n        if (from.padding.top !== undefined) self.padding.top = from.padding.top;\r\n        if (from.padding.right !== undefined) self.padding.right = from.padding.right;\r\n        if (from.padding.bottom !== undefined) self.padding.bottom = from.padding.bottom;\r\n        if (from.padding.left !== undefined) self.padding.left = from.padding.left;\r\n    }\r\n\r\n    return self;\r\n}\r\n"],"names":[],"mappings":"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"}