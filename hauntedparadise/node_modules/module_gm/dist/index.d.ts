declare module "module_gm" {
    /**
     * 下拉列表元素
     */
    export abstract class DropdownItem extends UIScript {
        /** 下拉列表 */
        list?: DropdownList<any>;
        /** 数据 */
        data?: any;
    }
    /**
     * GMUI接口
     */
    interface IGMUI extends UIScript {
        /** 确定按钮 */
        okButton: Button;
        /** 命令面板 */
        cmdPanel: PanelWidget;
        /** 下拉列表 */
        dropList: ScrollBox;
        /** 输入框 */
        argText: InputBox;
        /** 分组按钮 */
        groupButton: StaleButton;
        /** 命令按钮 */
        cmdButton: StaleButton;
    }
    /**
     * 下拉列表
     */
    export class DropdownList<T extends DropdownItem> {
        private _root;
        private _itemCls;
        private space;
        /** 不显示的缓存道具 */
        private _cache;
        /** 显示的道具 */
        private _items;
        /** 是否下拉 */
        private _isDropdown;
        /** 点击委托 */
        onSelect: Action1<string>;
        constructor(_root: IGMUI, _itemCls: {
            new (): T;
        }, space?: number);
        /**
        * 添加展开按钮事件
        */
        toggle(): void;
        /**
         * 添加展开按钮事件
         */
        expand(): void;
        /**
         * 添加展开按钮事件
         */
        unExpand(): void;
        /**
         * 添加一个选项
         * @param node
         * @param index 索引
         */
        addItem(data: any, index?: number): void;
        /**
         * 删除一个选项
         * @param node
         */
        removeItem(node: any): void;
        /**
         * 清楚列表
         */
        clear(): void;
        /**
         * 删除一个指定索引
         * @param index
         */
        removeItemAt(index: any): void;
        /**
         * 获取一个选项,超出范围则返回空
         * @param index
         */
        getItem(index: any): T;
        /**
         * 获取选项数量
         */
        get size(): number;
        /**
         * 重新对齐面板
         */
        _invalidateLayout(): void;
    }
}

declare module "module_gm" {
    /**
     * GM服务, 用于初始化GM配置，调用GM命令
     */
    export class GMService {
        /** GM服务单例 */
        private static _instance;
        /** 是否获取了GM用户列表 */
        private isGetGMUserList;
        /** 有权限的用户列表 */
        private userList;
        /** 是否有GM权限的回调 */
        private authorityCallback;
        /** 是否已经初始化 */
        private isInited;
        /**
         * 获取GM服务单例
         * @returns GM服务单例
         */
        static get instance(): GMService;
        /**
         * 初始化GM服务
         */
        init(): void;
        /**
         * 初始化UI
         */
        createUI(dropDownList: DropdownList<any>): void;
        constructor();
        /**
         * 获取权限
         * @param isTemporaryStorage 是否临时存储
         * @param userId 用户ID
         */
        private getAuthority;
        /**
         * 客户调用，判断主控端是否有GM权限
         * @param isTemporaryStorage 是否临时存储
         * @param callback 回调
         */
        checkGMAuthority(isTemporaryStorage: boolean, callback: (isGM: boolean) => void): void;
        /**
         * 调用命令
         * @param data
         */
        cmd(data: GMData, param: string): void;
    }
}

declare module "module_gm" {
    /** GM数据类型 */
    export type GMData = {
        label: string;
        group: string;
        clientCmd?: (player: Player, value: string) => void;
        serverCmd?: (player: Player, value: string) => void;
        shortKey?: Keys;
    };
    /** GM配置 */
    export const GMConfig: any[];
    /**
     * 添加GM命令
     * @param label 名称
     * @param cmdClient 客户端命令
     * @param cmdServer 服务端命令
     * @param shortKey 快捷键
     */
    export function AddGMCommand(label: string, cmdClient?: (player: Player, value: string) => void, cmdServer?: (player: Player, value: string) => void, group?: string, shortKey?: Keys): void;
}

declare module "module_gm" {
    interface IGMItem extends DropdownItem {
        button: StaleButton;
    }
    interface IGMUI extends UIScript {
        /** 确定按钮 */
        okButton: Button;
        /** 命令面板 */
        cmdPanel: PanelWidget;
        /** 下拉列表 */
        dropList: ScrollBox;
        /** 输入框 */
        argText: InputBox;
        /** 分组按钮 */
        groupButton: StaleButton;
        /** 命令按钮 */
        cmdButton: StaleButton;
    }
    /**
     * GM基础面板
     */
    export abstract class GMBasePanel<T extends IGMUI, I extends IGMItem> {
        /** 下拉列表 */
        private dropDownList;
        /** 是否是分组 */
        private isGroup;
        /** 分组名称 */
        private groupText;
        /** 命令名称 */
        private cmdText;
        /** UI实例 */
        private _view;
        constructor(_viewCls: {
            new (): T;
        }, _itemCls: {
            new (): I;
        });
        /**
         * 显示GM面板
         */
        show(): void;
    }
}

declare module "module_gm" {
    /**
     * GM模块
     */
    export namespace GM {
        let getParam: () => string;
        /**
         * 客户端调用，开始GM
         * @param uiClass
         */
        function start(uiClass: {
            new (): Required<GMBasePanel<any, any>>;
        }): void;
        /**
         * 客户端调用，查看是否有GM权限
         * ```
         * 权限来自开发者后台自定义存档GM.UserList
         * 结构为["userId1","userId2","userId3",....]
         * 如需增加GM权限，只需在存档中添加userId即可
         * ```
         * @param callback true-有GM权限，false-无GM权限
         * @param isTemporaryStorage 是否是临时存档 default: SystemUtil.isPIE
         */
        function checkAuthority(callback: (isGM: boolean) => void, isTemporaryStorage?: boolean): void;
    }
}
