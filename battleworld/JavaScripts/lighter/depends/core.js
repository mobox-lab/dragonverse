function e(e,t,s,r){var i,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,s,r);else for(var l=e.length-1;l>=0;l--)(i=e[l])&&(o=(n<3?i(o):n>3?i(t,s,o):i(t,s))||o);return n>3&&o&&Object.defineProperty(t,s,o),o}var t;"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.STANDALONE=1]="STANDALONE",e[e.IMPLICIT_VISIBLE=2]="IMPLICIT_VISIBLE",e[e.IMPLICIT_SERIALIZABLE=4]="IMPLICIT_SERIALIZABLE"}(t||(t={}));const s="__ctors__";const r="__tsClassCache__";function i(e,t){return e[t]||(e[t]={})}function n(e){return e?.hasOwnProperty?.(s)}function o(e,s){const n=i(e.constructor,r);const o=i(n,"proto"),l=i(o,"properties");l[s]||(l[s]={});const a=l[s];return a.__internalFlags|=t.STANDALONE,function(e,t,s,r){const i=e.default||(e.default=function(e){if("dotNotInstanceMe"in e)return{};let t;try{t=new e}catch(e){return{}}return t}(s));i.hasOwnProperty(r)&&(t.default=i[r])}(n,a,e.constructor,s),a}const l=(e,s)=>{!function(e){e.__internalFlags|=t.IMPLICIT_SERIALIZABLE}(o(e,s))};class a{constructor(e){this.id=0|998*Math.random(),this.prefix=e?e+".":""}getNewId(){return this.prefix+(++this.id).toString()}}a.global=new a("global");const u="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),c="__classname__",h="__cid__",d=new a("TmpCId.");const _=(()=>{const e={value:void 0,enumerable:!1,writable:!1,configurable:!0};return(t,s,r,i,n)=>{e.value=r,e.writable=i,e.enumerable=n,Object.defineProperty(t,s,e),e.value=void 0}})(),f=(()=>{const e={get:void 0,set:void 0,enumerable:!1};return(t,s,r,i,n=!1,o=!1)=>{"boolean"==typeof i&&(console.log("Set `setter` to boolean is deprecated. Please don not use like this again."),n=i,i=void 0),e.get=r,e.set=i,e.enumerable=n,e.configurable=o,Object.defineProperty(t,s,e),e.get=void 0,e.set=void 0}})(),p=(()=>{const e={get:void 0,enumerable:!1,configurable:!1};return(t,s,r,i,n)=>{e.get=r,e.enumerable=i,e.configurable=n,Object.defineProperty(t,s,e),e.get=void 0}})(),g=(()=>{const e={set:void 0,enumerable:!1,configurable:!1};return(t,s,r,i,n)=>{e.set=r,e.enumerable=i,e.configurable=n,Object.defineProperty(t,s,e),e.set=void 0}})();function y(e){const t=Object.create(null);if(e){const e=".",s="/";t[e]=1,t[s]=1,delete t[e],delete t[s]}return t}function m(e,t,s,r){const i=/([^.]+)$/,n=i.exec(t)[0],o=i.exec(s)[0];function l(){return this[o]}r?f(e,n,l,(function(e){this[o]=e})):p(e,n,l)}const b=/(%d)|(%s)/,v=/%s/;function A(e,t){for(;e;){const s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Object.getPrototypeOf(e)}return null}function z(e,t,s){const r=A(t,e);r&&Object.defineProperty(s,e,r)}function O(e,...t){e=e||{};for(const s of t)if(s){if("object"!=typeof s)continue;for(const t in s)z(t,s,e)}return e}function w(e){if(!e)return null;const t=e.prototype,s=t&&Object.getPrototypeOf(t);return s&&s.constructor}function T(e){for(const t of Object.keys(e))delete e[t]}function L(e){return"string"!=typeof e||e.startsWith(d.prefix)}const P=y(!0),C=y(!0);function I(e,t,s){return function(r,i){if(i.prototype.hasOwnProperty(e)&&delete t[i.prototype[e]],_(i.prototype,e,r),r){const n=t[r];!s&&n&&n!==i?console.warn(`A Class already exists with the same ${e} : "${r}".`):t[r]=i}}}globalThis._idToClass=P,globalThis._nameToClass=C;const j=I("__cid__",P,!1),F=I("__classname__",C,!0);function x(e){return P[e]}function S(e,t){let s;if(t=void 0===t||t,"function"==typeof e&&e.prototype.hasOwnProperty(h))return s=e.prototype[h],!t&&L(s)?"":s;if(e&&e.constructor){const r=e.constructor.prototype;if(r&&r.hasOwnProperty(h))return s=e[h],!t&&L(s)?"":s}return""}var D=Object.freeze({__proto__:null,_getClassById:function(e){return x(e)},_getClassId:function(e,t){return S(e,t)},_idToClass:P,_nameToClass:C,_setClassId:j,addon:function(e,...t){e=e||{};for(const s of t)if(s){if("object"!=typeof s)continue;for(const t in s)t in e||z(t,s,e)}return e},clear:T,copyAllProperties:function(e,t,s){const r=Object.getOwnPropertyNames(e);for(let i=0,n=r.length;i<n;++i){const n=r[i];-1===s.indexOf(n)&&z(n,e,t)}},createMap:y,extend:function(e,t){for(const s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e.prototype=Object.create(t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),e},formatStr:function(e,...t){if(0===arguments.length)return"";if(0===t.length)return`${e}`;if("string"==typeof e&&b.test(e))for(const s of t){const t="number"==typeof s?b:v;if(t.test(e)){const r=`${s}`;e=e.replace(t,r)}else e+=` ${s}`}else for(const s of t)e+=` ${s}`;return e},get:p,getClassById:x,getClassByName:function(e){return C[e]},getClassId:S,getClassName:function e(t){if("function"==typeof t){const e=t.prototype;if(e&&e.hasOwnProperty(c)&&e[c])return e[c];let s="";if(t.name&&(s=t.name),t.toString){let e;const r=t.toString();e="["===r.charAt(0)?/\[\w+\s*(\w+)\]/.exec(r):/function\s*(\w+)/.exec(r),e&&2===e.length&&(s=e[1])}return"Object"!==s?s:""}return t&&t.constructor?e(t.constructor):""},getPropertyDescriptor:A,getSuper:w,getset:f,is:function(e,t){if("string"==typeof t)return t in e;if(Array.isArray(t)){for(const s of t)if(!(s in e))return!1;return!0}return t(e)},isChildClassOf:function(e,t){if(e&&t){if("function"!=typeof e)return!1;if("function"!=typeof t)return!1;if(e===t)return!0;for(;;){if(!(e=w(e)))return!1;if(e===t)return!0}}return!1},isEmptyObject:function(e){for(const t in e)return!1;return!0},isNumber:function(e){return"number"==typeof e||e instanceof Number},isString:function(e){return"string"==typeof e||e instanceof String},mixin:O,obsolete:m,obsoletes:function(e,t,s,r){for(const i in s){m(e,`${t}.${i}`,s[i],r)}},set:g,setClassAlias:function(e,t){const s=C[t],r=P[t];let i=!0;if(s&&s!==e&&(console.error(`"${t}" has already been set as name or alias of another class.`),i=!1),r&&r!==e&&(console.error(`"${t}" has already been set as id or alias of another class.`),i=!1),i){let s=e[u];s||(s=[],e[u]=s),s.push(t),C[t]=e,P[t]=e}},setClassName:function(e,t){if(F(e,t),!t.prototype.hasOwnProperty(h)){const s=e||d.getNewId();s&&j(s,t)}},shiftArguments:function(){const e=arguments.length-1,t=new Array(e);for(let s=0;s<e;++s)t[s]=arguments[s+1];return t},unregisterClass:function(...e){for(const t of e){const e=t.prototype,s=e[h];s&&delete P[s];const r=e[c];r&&delete C[r];const i=e[u];if(i)for(let e=0;e<i.length;++e){const t=i[e];delete C[t],delete P[t]}}},value:_});function M(e,t){e.splice(t,1)}function E(e,t){const s=e.indexOf(t);return s>=0&&(M(e,s),!0)}var N=Object.freeze({__proto__:null,appendObjectsAt:function(e,t,s){return e.splice.apply(e,[s,0,...t]),e},contains:function(e,t){return e.indexOf(t)>=0},copy:function(e){const t=e.length,s=new Array(t);for(let r=0;r<t;r+=1)s[r]=e[r];return s},fastRemove:function(e,t){const s=e.indexOf(t);s>=0&&(e[s]=e[e.length-1],--e.length)},fastRemoveAt:function(e,t){const s=e.length;t<0||t>=s||(e[t]=e[s-1],e.length=s-1)},remove:E,removeArray:function(e,t){for(let s=0,r=t.length;s<r;s++)E(e,t[s])},removeAt:M,removeIf:function(e,t){const s=e.findIndex(t);if(s>=0){const t=e[s];return M(e,s),t}},verifyType:function(e,t){if(e&&e.length>0)for(const s of e)if(!(s instanceof t))return!1;return!0}});const $=new Array(123);for(let e=0;e<123;++e)$[e]=64;for(let e=0;e<64;++e)$["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(e)]=e;const B=$;var R=Object.freeze({__proto__:null,BASE64_VALUES:B,BUILTIN_CLASSID_RE:/mw/g});const V="@",k="0123456789abcdef".split(""),U=["","","",""],Q=U.concat(U,"-",U,"-",U,"-",U,"-",U,U,U),W=Q.map(((e,t)=>"-"===e?NaN:t)).filter(Number.isFinite);function J(e){const t=e.split(V)[0];if(22!==t.length)return e;Q[0]=e[0],Q[1]=e[1];for(let t=2,s=2;t<22;t+=2){const r=B[e.charCodeAt(t)],i=B[e.charCodeAt(t+1)];Q[W[s++]]=k[r>>2],Q[W[s++]]=k[(3&r)<<2|i>>4],Q[W[s++]]=k[15&i]}return e.replace(t,Q.join(""))}class H{constructor(e=null,t,s=null,r=!1){this.once=!1,this._id=0,this.ref=0,this.setTo(e,t,s,r)}setTo(e,t,s,r=!1){return this._id=H._gid++,this.caller=e,this.method=t,this.args=s,this.once=r,this}run(){if(null===this.method)return null;const e=this._id,t=this.method.apply(this.caller,this.args);return this._id===e&&this.once&&this.recover(),t}runWith(...e){if(null===this.method)return null;const t=this._id;let s;return s=null===e?this.method.apply(this.caller,this.args):this.args?this.method.apply(this.caller,[...e,...this.args]):this.method.apply(this.caller,e),this._id===t&&this.once&&this.recover(),s}clear(){return this.caller=null,this.method=null,this.args=null,this}recover(){this._id>0&&(this._id=0,this.ref-=1,H._pool.push(this.clear()))}static create(e,t,s=null,r=!1){let i;if(i=H._pool.length?H._pool.pop().setTo(e,t,s,r):new H(e,t,s,r),i.ref+=1,i.ref>1)throw new Error("handler ref error");return i}static is(e){return e.run&&e.runWith}}H._pool=[],H._gid=1;class q extends H{}class G{hasListener(e){return!!(this._events&&this._events[e])}event(e,...t){if(!this._events||!this._events[e])return!1;const s=this._events[e];if(Z.is(s))s.once&&delete this._events[e],null!==t?s.runWith(...t):s.run();else{for(let e=0,r=s.length;e<r;e++){const i=s[e];i&&(null!==t?i.runWith(...t):i.run()),i&&!i.once||(s.splice(e,1),e--,r--)}0===s.length&&this._events&&delete this._events[e]}return!0}on(e,t,s,...r){return this.createListener(e,t,s,r,!1)}once(e,t,s,...r){return this.createListener(e,t,s,r,!0)}createListener(e,t,s,r,i,n=!0){n&&this.off(e,t,s,i);const o=Z.create(t||this,s,r,i);this._events||(this._events={});const l=this._events;return l[e]?l[e].run?l[e]=[l[e],o]:l[e].push(o):l[e]=o,this}off(e,t,s,r=!1){if(!this._events||!this._events[e])return this;const i=this._events[e];if(null!==i)if(Z.is(i))t&&i.caller!==t||null!==s&&i.method!==s||r&&!i.once||(delete this._events[e],i.recover());else{let n=0;const o=i.length;for(let e=0;e<o;e++){const o=i[e];o?!o||t&&o.caller!==t||null!==s&&o.method!==s||r&&!o.once||(n++,i[e]=null,o.recover()):n++}n===o&&delete this._events[e]}return this}offAll(e=null){const t=this._events;if(!t)return this;if(e)this.recoverHandlers(t[e]),delete t[e];else{for(const e in t)this.recoverHandlers(t[e]);this._events=null}return this}offAllCaller(e){if(e&&this._events)for(const t in this._events)this.off(t,e,null);return this}recoverHandlers(e){if(e)if(e.run)e.recover();else for(let t=e.length-1;t>-1;t--)e[t]&&(e[t].recover(),e[t]=null)}}class Z extends q{constructor(e,t,s,r){super(e,t,s,r)}recover(){this._id>0&&(this._id=0,Z._pool.push(this.clear()))}static create(e,t,s=null,r=!0){return Z._pool.length?Z._pool.pop().setTo(e,t,s,r):new Z(e,t,s,r)}}Z._pool=[];const K=/(\.[^\.\/\?\\]*)(\?.*)?$/,X=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,Y=/[^\.\/]+\/\.\.\//;function ee(e){const t=K.exec(e);return t?t[1]:""}function te(e,t){t=t||"";let s=e.indexOf("?"),r="";return s>0&&(r=e.substring(s),e=e.substring(0,s)),s=e.lastIndexOf("."),s<0?e+t+r:e.substring(0,s)+t+r}function se(e){return e.replace(/[\/\\]$/,"")}var re=Object.freeze({__proto__:null,_normalize:function(e){let t=e=String(e);do{t=e,e=e.replace(Y,"")}while(t.length!==e.length);return e},basename:function(e,t){const s=e.indexOf("?");s>0&&(e=e.substring(0,s));const r=/(\/|\\)([^\/\\]+)$/g.exec(e.replace(/(\/|\\)$/,""));if(!r)return e;const i=r[2];return t&&e.substring(e.length-t.length).toLowerCase()===t.toLowerCase()?i.substring(0,i.length-t.length):i},changeBasename:function(e,t,s){if(0===t.indexOf("."))return te(e,t);let r=e.indexOf("?"),i="";const n=s?ee(e):"";return r>0&&(i=e.substring(r),e=e.substring(0,r)),r=e.lastIndexOf("/"),r=r<=0?0:r+1,e.substring(0,r)+t+n+i},changeExtname:te,dirname:function(e){const t=X.exec(e);return t?t[2]:""},extname:ee,getSeparator:function(){return"\\"},join:function(...e){let t="";for(const s of e)t=(t+(""===t?"":"/")+s).replace(/(\/|\\\\)$/,"");return t},mainFileName:function(e){if(e){const t=e.lastIndexOf(".");if(-1!==t)return e.substring(0,t)}return e},relativeTo:function(e,t){let s=se(e).split("/"),r=se(t).split("/"),i=Math.min(s.length,r.length),n=i;for(let e=0;e<i;e++)if(s[e]!==r[e]){n=e;break}let o=[];for(let e=n;e<s.length;e++)o.push("..");return o=o.concat(r.slice(n)),o.join("/")},stripSep:se});class ie{get(){return this._get()}constructor(e,t){const s=void 0===t?e:t,r=void 0===t?null:e;this.count=0,this._pool=new Array(s),this._cleanup=r}_get(){if(this.count>0){--this.count;const e=this._pool[this.count];return this._pool[this.count]=null,e}return null}put(e){const t=this._pool;if(this.count<t.length){if(this._cleanup&&!1===this._cleanup(e))return;t[this.count]=e,++this.count}}resize(e){e>=0&&(this._pool.length=e,this.count>e&&(this.count=e))}}class ne{constructor(){this._previousTime=0,this._currentTime=0,this._delta=0,this._elapsed=0,this._timescale=1,this._useFixedDelta=!1,this._fixedDelta=16.67,this._previousTime=0,this._currentTime=0,this._delta=0,this._elapsed=0,this._timescale=1,this._useFixedDelta=!1,this._fixedDelta=16.67}disableFixedDelta(){return this._useFixedDelta=!1,this}dispose(){return this}enableFixedDelta(){return this._useFixedDelta=!0,this}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getFixedDelta(){return this._fixedDelta/1e3}getTimescale(){return this._timescale}reset(){return this._elapsed=0,this._currentTime=this.innerNow(),this}setFixedDelta(e){return this._fixedDelta=1e3*e,this}setTimescale(e){return this._timescale=e,this}update(){return this._useFixedDelta?this._delta=this._fixedDelta:(this._previousTime=this._currentTime,this._currentTime=this.innerNow(),this._delta=this._currentTime-this._previousTime),this._delta*=this._timescale,this._elapsed+=this._delta,this}innerNow(){return Date.now()}}const oe={...D,get registeredClassNames(){return{...C}},set registeredClassNames(e){T(C),Object.assign(C,e)},get registeredClassIds(){return{...P}},set registeredClassIds(e){T(P),Object.assign(P,e)}},le={...N},ae={...R},ue={...re};var ce=Object.freeze({__proto__:null,EventDispatcher:G,Handler:q,IDGenerator:a,MutableForwardIterator:class{constructor(e){this.array=e,this.i=0}get length(){return this.array.length}set length(e){this.array.length=e,this.i>=e&&(this.i=e-1)}remove(e){const t=this.array.indexOf(e);t>=0&&this.removeAt(t)}removeAt(e){this.array.splice(e,1),e<=this.i&&--this.i}fastRemove(e){const t=this.array.indexOf(e);t>=0&&this.fastRemoveAt(t)}fastRemoveAt(e){const t=this.array;t[e]=t[t.length-1],--t.length,e<=this.i&&--this.i}push(e){this.array.push(e)}},Pool:ie,Regulator:class{constructor(e=0){this.updateFrequency=e,this._nextUpdateTime=0,this._time=new ne,this._nextUpdateTime=0}ready(){this._time.update();const e=this._time.getElapsed();return e>=this._nextUpdateTime&&(this._nextUpdateTime=e+1/this.updateFrequency,!0)}reset(){return this._nextUpdateTime=0,this._time.reset()}},THandler:H,Time:ne,array:le,decodeUuid:J,js:oe,misc:ae,path:ue});const he="$_$";function de(e,t){const s=t?Object.create(t):{};return oe.value(e,"__attrs__",s),s}function _e(e){if("function"!=typeof e){return de(e,fe(e.constructor))}let t;const s=function(e){const t=[];for(;e=oe.getSuper(e);)e!==Object&&t.push(e);return t}(e);for(let e=s.length-1;e>=0;e--){const r=s[e];r.hasOwnProperty("__attrs__")&&r.__attrs__||(t=s[e+1],de(r,t&&t.__attrs__))}return t=s[0],de(e,t&&t.__attrs__),e.__attrs__}function fe(e){return e.hasOwnProperty("__attrs__")&&e.__attrs__||_e(e)}function pe(e,s,r,i){!function(e,t){!function(e,t){e.indexOf(t)<0&&e.push(t)}(e.__props__,t)}(e,r),function(e,s,r,i,n){let o=null,l="";function a(){return l=i+he,o=fe(e)}"type"in s&&void 0===s.type&&console.warn("type of "+i+" is undefined"),"default"in s&&((o||a())[`${l}default`]=s.default);const u=(e,t)=>{if(e in s){const r=s[e];typeof r===t&&((o||a())[l+e]=r)}};s.editorOnly&&((o||a())[`${l}editorOnly`]=!0),u("displayName","string"),u("displayOrder","number"),u("multiline","boolean"),u("radian","boolean"),s.readonly&&((o||a())[`${l}readonly`]=s.readonly),u("tooltip","string"),s.group&&((o||a())[`${l}group`]=s.group),u("slide","boolean"),u("unit","string"),u("radioGroup","boolean");const c=s.__internalFlags&t.STANDALONE;let h;c?h=!0===s.serializable||!!(s.__internalFlags&t.IMPLICIT_SERIALIZABLE):!1===s.serializable&&(h=!1),void 0!==h&&((o||a())[`${l}serializable`]=h),u("formerlySerializedAs","string"),"animatable"in s&&((o||a())[`${l}animatable`]=s.animatable);const d=s.visible;let _;switch(typeof d){case"boolean":case"function":_=d;break;default:c?_=!!(s.__internalFlags&t.IMPLICIT_VISIBLE):95===i.charCodeAt(0)&&(_=!1)}void 0!==_&&((o||a())[`${l}visible`]=_);const f=s.range;f&&Array.isArray(f)&&f.length>=2&&((o||a())[`${l}min`]=f[0],o[`${l}max`]=f[1],f.length>2&&(o[`${l}step`]=f[2])),u("min","number"),u("max","number"),u("step","number")}(e,i,0,r)}function ge(e){let t=e.name;const r=e.extends,i=function(e,t,r){const i=function(e,t,r){const i=r.ctor;oe.value(i,s,!0,!0),t&&(i.$super=t);return oe.setClassName(e,i),i}(e,t,r);return i}(t,r,e);t||(t=oe.getClassName(i)),i._sealed=!0,r&&(r._sealed=!1);return function(e,t,s,r){if(e.__props__=[],r&&r.__props__&&(e.__props__=r.__props__.slice()),s)for(const t in s)pe(e,0,t,s[t]);const i=fe(e);e.__values__=e.__props__.filter((e=>!1!==i[`${e}${he}serializable`]))}(i,0,e.properties,r),i}const ye=(me=(e,t)=>{let s=w(e);s===Object&&(s=null);const i={name:t,extends:s,ctor:e},n=e[r];if(n){const t=n.proto;t&&O(i,t),e[r]=void 0}return ge(i)},function(e){return"function"==typeof e?me(e):function(t){return me(t,e)}});var me;let be=class{constructor(){this._ref=0,this.nativeUrl=""}get refCount(){return this._ref}addRef(){return this._ref++,this}decreaseRef(e=!0){return this._ref>0&&this._ref--,e&&this._ref,this}validate(){return!0}destroy(){}onLoaded(){}};e([l],be.prototype,"nativeUrl",void 0),be=e([ye],be);var ve=Object.freeze({__proto__:null,isTsClass:n,serializable:l,tsclass:ye});const Ae={_Vector:mw.Vector,_Vector2:mw.Vector2,_Vector4:mw.Vector4,_Quaternion:mw.Quaternion,_LineColor:mw.LinearColor,_Transform:mw.Transform,_Rotation:mw.Rotation};function ze(e){if(void 0===e)return!1;let t="string"==typeof e?e:e.name;return void 0!==Ae[t]}function Oe(e){let t=e.constructor.name;return e instanceof mw.Quaternion?{__type__:t,value:JSON.stringify([e.x,e.y,e.z,e.w])}:{__type__:t,value:e.toString()}}const we=Symbol("[[Deserialize]]"),Te=function(e,t){const s=function(e){return ae.BUILTIN_CLASSID_RE.test(oe.getClassId(e))}(t);let r=!1;const i=[];let n=i;const o=[];let l=o;const a=[];return(()=>{const e=t.__values__;r="_$erialized"===e[e.length-1];const u=fe(t);for(let t=0;t<e.length;t++){const r=e[t];let h=r;u[r+Ie]&&(h=u[r+Ie]);const d="function"==typeof(c=u[r+Ce])?c():c,_=u[r+Pe];let f=!1;s&&(void 0!==d||_)&&(f=je(d)),f?(h!==r&&n===i&&(n=i.slice()),i.push(r),n!==i&&n.push(h)):(h!==r&&l===o&&(l=o.slice()),o.push(r),l!==o&&l.push(h),a.push(ze(d)&&d.constructor))}var c})(),(e,t,u,c)=>{for(let e=0;e<i.length;++e){const s=u[n[e]];void 0!==s&&(t[i[e]]=s)}for(let r=0;r<o.length;++r){const i=o[r],n=u[l[r]];if(void 0!==n)if(s||"object"==typeof n){const o=a[r];o?s||n?e._deserializeFastDefinedObject(t[i],n,o):t[i]=null:n?e._deserializeAndAssignField(t,n,i):t[i]=null}else t[i]=n}r&&(t._$erialized=JSON.parse(JSON.stringify(u)),e._fillPlainObject(t._$erialized,u))}},Le="$_$",Pe=`${Le}type`,Ce=`${Le}default`,Ie=`${Le}formerlySerializedAs`;function je(e,t){const s=typeof e;return"string"===s||"number"===s||"boolean"===s}class Fe extends ie{constructor(){super((e=>{e.clear()}),1)}}Fe.prototype.get=function(e,t,s,r,i){const n=this._get();return n?(n.reset(e,t,s,r,i),n):new xe(e,t,s,r,i)};class xe{get ignoreEditorOnly(){return this._ignoreEditorOnly}constructor(e,t,s,r,i){this.result=e,this.customEnv=r,this.deserializedList=[],this.deserializedData=null,this._classFinder=t,this._reportMissingClass=s,this._onDereferenced=t?.onDereferenced}reset(e,t,s,r,i){this.result=e,this.customEnv=r,this._classFinder=t,this._reportMissingClass=s,this._onDereferenced=t?.onDereferenced}clear(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null}deserialize(e){let t=e;this._serializedData=t;const s=Array.isArray(t)?t[0]:t;return this.deserializedData=this._deserializeObject(s,0),this._serializedData=void 0,this.deserializedData}_deserializeObject(e,t,s,r){switch(e.__type__){case"TypedArray":return this._deserializeTypedArrayView(e);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(e);case"Map":return this._deserializeMap(e);case"Set":return this._deserializeSet(e);default:const i=e.__type__;return i?ze(i)?function(e){if("_Quaternion"===e.__type__){let t=new mw.Quaternion;const s=JSON.parse(e.value);return t.set(s[0],s[1],s[2],s[3]),t}return Ae[e.__type__].fromString(e.value)}(e):this._deserializeTypeTaggedObject(e,t,s,r):Array.isArray(e)?this._deserializeArray(e):this._deserializePlainObject(e)}}_deserializeTypedArrayView(e){return globalThis[e.ctor].from(e.array)}_deserializeTypedArrayViewRef(e){const{offset:t,length:s,ctor:r}=e;return new globalThis[r](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+t,s)}_deserializeMap(e){const t=new Map;let s=this._deserializeArray(e.keys),r=this._deserializeArray(e.values);for(let e=0;e<s.length;e++){const i=s[e],n=r[e];t.set(i,n)}return t}_deserializeSet(e){let t=this._deserializeArray(e.values);return new Set(t)}_deserializeArray(e){const t=new Array(e.length);let s;for(let r=0;r<e.length;r++)if(s=e[r],"object"==typeof s&&s){this._deserializeAndAssignField(t,s,`${r}`)&&(t[r]=null)}else t[r]=s;return t}_deserializePlainObject(e){const t={};return this._fillPlainObject(t,e),t}_deserializeTypeTaggedObject(e,t,s,r){const i=e.__type__,n=this._classFinder(i,e,s,r);if(!n){return this._classFinder===oe.getClassById&&this._reportMissingClass?.call(null,i),null}const o=e=>{const s=new e;return t>=0&&(this.deserializedList[t]=s),s};try{const t=o(n);return this._deserializeInto(e,t,n),t}catch(e){throw new Error("Failed to deserialize: "+e)}}_deserializeInto(e,t,s,r=!1){r||!t[we]?t._deserialize?t._deserialize(e.content,this):n(s)?this._deserializeFireClass(t,e,s):this._deserializeFastDefinedObject(t,e,s):this._runCustomizedDeserialize(e,t,s)}_runCustomizedDeserialize(e,t,s){const r={readProperty:t=>{const s=e[t];return"object"==typeof s&&s?this._deserializeObjectField(s):s},readThis:()=>{this._deserializeInto(e,t,s,!0)},readSuper:()=>{const r=oe.getSuper(s);r&&this._deserializeInto(e,t,r)}};t[we](r,{})}_deserializeFireClass(e,t,s){let r;s.hasOwnProperty("__deserialize__")?r=s.__deserialize__:(r=Te(this,s),oe.value(s,"__deserialize__",r,!0)),r(this,e,t,s)}_deserializeAndAssignField(e,t,s){const r=t.__id__;if("number"==typeof r){const t=this.deserializedList[r];if(t)e[s]=t;else{const t=this._serializedData[r];e[s]=this._deserializeObject(t,r,void 0,s),this._onDereferenced?.(this.deserializedList,r,e,s)}}else{const r=t.__uuid__;if(r){const i=t.__expectedType__;this.result.push(e,s,r,i)}else e[s]=this._deserializeObject(t,-1)}return!1}_deserializeObjectField(e){const t=e.__id__;if("number"==typeof t){const e=this.deserializedList[t];if(e)return e;{const e=this._serializedData[t];return this._deserializeObject(e,t,void 0,void 0)}}if(e.__uuid__)throw new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(e,-1)}_fillPlainObject(e,t){for(const s in t){if(!t.hasOwnProperty(s))continue;const r=t[s];if("object"!=typeof r)"__type__"!==s&&(e[s]=r);else if(r){this._deserializeAndAssignField(e,r,s)&&(e[s]=null)}else e[s]=null}}_deserializeFastDefinedObject(e,t,s){const r=s.__props__;for(let s=0;s<r.length;s++){const i=r[s];let n=t[i];void 0!==n||t.hasOwnProperty(i),"object"!=typeof n?e[i]=n:n?this._deserializeAndAssignField(e,n,i):e[i]=null}}}xe.pool=new Fe;class Se{constructor(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}init(){this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])}reset(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)}push(e,t,s,r){this.uuidObjList.push(e),this.uuidPropList.push(t),this.uuidList.push(s),this.uuidTypeList.push(r||"")}}function De(e,t,s){"string"==typeof e&&(e=JSON.parse(e));let r=!1;if(!t){const e=Se.pool.get();if(e)throw new Error("Can not allocate deserialization details");t=e,r=!0}const i=function(e,t,s){const r=(s=s||{}).classFinder||oe.getClassById,i=s.customEnv,n=s.ignoreEditorOnly,o=s.reportMissingClass??null;t.init();const l=xe.pool.get(t,r,o,i,n),a=l.deserialize(e);return xe.pool.put(l),a}(e,t,s);return r&&Se.pool.put(t),i}Se.pool=new ie((e=>{e.reset()}),5),Se.pool.get=function(){return this._get()||new Se};const Me=new WeakMap;const Ee=[];var Ne=Object.freeze({__proto__:null,get Asset(){return be},AssetsManager:class{constructor(){this.version="1.0.0",this._isAssetLoaded=!1,this._assetsMetaInfo=new Map,this._assets=new Map,this._assetTypeLookTable=new Map,this._assetPlugins=new Map}registerAssetsPlugin(e){this._assetPlugins.set(e.name,e),e.sourceMgr=this,this._isAssetLoaded&&this.handlePluginAsset(e)}unRegisterAssetsPlugin(e){this._assetPlugins.delete(e.name),e.clear()}loadAsset(e){const t=function(e,t){let s;s=function(e){const t=oe.getClassById(e);if(t)return t};const r=Se.pool.get();let i;try{i=De(e,r,{classFinder:s,customEnv:t})}catch(e){throw Se.pool.put(r),e}i.uuid=t.__uuid__||"";const n=r.uuidList,o=r.uuidObjList,l=r.uuidPropList,a=r.uuidTypeList||[],u=[];for(let e=0;e<n.length;e++){const t=n[e];u[e]={uuid:J(t),owner:o[e],prop:l[e],type:oe.getClassById(a[e])}}return Me.set(i,u),Se.pool.put(r),i}(e.asset,{__uuid__:e.uuid,version:e.ver});t?.onLoaded(),this.internalLoadAsset(t,{uuid:e.uuid,type:e.type,ver:e.ver,subVer:e.subVer})}loadAssetsComplete(){this._isAssetLoaded=!0,this._assetPlugins.forEach((e=>{this.handlePluginAsset(e)}))}handlePluginAsset(e){Ee.length=0;let t=this.getAssetsByType(e.name);t&&t.forEach((t=>{let s=this._assetsMetaInfo.get(t);const r=this.getAsset(t);if(s.subVer!==e.version){if(!e.handleUnMatchedVersion(r,s.subVer))return;s.subVer=e.version,this.postedAssetUpgraded(r,s)}Ee.push(r)})),e.initialize(Ee)}getAsset(e){return this._assets.get(e)}hasAsset(e){return this._assets.has(e)}deleteAsset(e){const t=this.getAsset(e);t&&this.internalRemoveAsset(t)}getAssetsByType(e){return this.internalGetAssetTypeSet(e,!0)}postedAssetUpgraded(e,t){}getAssetMetaInfo(e){return this._assetsMetaInfo.get(e)}internalLoadAsset(e,t){this._assets.has(t.uuid)||(this._assets.set(t.uuid,e),this.getAssetsByType(t.type).push(t.uuid),this._assetsMetaInfo.set(t.uuid,t))}internalRemoveAsset(e){this._assets.delete(e.uuid);let t=this._assetsMetaInfo.get(e.uuid);const s=this.getAssetsByType(t.type);let r=s.indexOf(e.uuid);s.splice(r,1),this._assetsMetaInfo.delete(e.uuid)}internalGetAssetTypeSet(e,t=!0){return!this._assetTypeLookTable.has(e)&&t&&this._assetTypeLookTable.set(e,[]),this._assetTypeLookTable.get(e)}clear(){this._assets.clear(),this._assetsMetaInfo.clear(),this._assetTypeLookTable.clear(),this._assetPlugins.forEach((e=>{e.clear()})),this._assetPlugins.clear()}},BaseAssetPlugin:class{get assetsList(){return this.sourceMgr.getAssetsByType(this.name)}handleUnMatchedVersion(e,t){if(Number(t.replace(/\./g,""))>Number(this.version.replace(/\./g,"")))return console.error(`${this.name}插件解析资源错误:${e.uuid}资源版高于当前插件版本,请升级插件`),!1;this.upgradeAsset(e,t,this.version)}initialize(e){}upgradeAsset(e,t,s){}}});class $e extends q{constructor(){super(...arguments),this.elapsed=0,this.duration=0,this.loop=-1}get handler(){return this._id}static create(e,t,s=null,r=!1){return super.create(e,t,s,r)}clear(){return super.clear(),delete this.elapsed,delete this.duration,delete this.loop,this}}var Be=Object.freeze({__proto__:null,EventManager:class extends G{trigger(e,...t){this.event(e,...t)}},SchedulerController:class{constructor(){this._timer=new ne,this._isPause=!1,this._handlers=[]}tick(){if(this._isPause)return;this._timer.update();const e=this._timer.getDelta();for(let t=this._handlers.length-1;t>=0;t--){const s=this._handlers[t];s.elapsed+=e,s.elapsed>=s.duration&&(s.run(),-1===s.loop?s.elapsed=0:(s.loop--,s.loop<=0&&(this._handlers.splice(t,1),s.recover())))}}once(e,t,s,...r){const i=this.getTimer(e,1,!0,t,s,...r);return this._handlers.push(i),i.handler}loop(e,t,s,...r){const i=this.getTimer(e,-1,!1,t,s,...r);return this._handlers.push(i),i.handler}callLater(e,t,...s){const r=this.getTimer(1,1,!0,e,t,...s);return this._handlers.push(r),r.handler}hasTimer(e,t){const s=this.getQueryFunction(...arguments);for(const e of this._handlers)if(s(e,...arguments))return!0;return!1}remove(...e){const t=this.getQueryFunction(...arguments);for(let e=this._handlers.length-1;e>=0;e--){const s=this._handlers[e];if(t(s,...arguments)){this._handlers.splice(e,1),s.recover();break}}}removeAll(e){for(let t=this._handlers.length-1;t>=0;t--){const s=this._handlers[t];s.caller===e&&(this._handlers.splice(t,1),s.recover())}}clear(){for(let e=this._handlers.length-1;e>=0;e--){this._handlers[e].recover()}this._handlers.length=0}run(...e){const t=this.getQueryFunction(...arguments);for(let e=this._handlers.length;e>=0;e--){const s=this._handlers[e];if(t(s,...arguments)){this._handlers.splice(e,1),s.run(),s.recover();break}}}pause(){this._isPause=!0}resume(){this._isPause=!1}set scale(e){this._timer.setTimescale(e)}get elapsed(){return this._timer.getElapsed()}get delta(){return this._timer.getDelta()}getTimer(e,t,s,r,i,...n){const o=$e.create(r,i,n,s);return o.duration=e,o.elapsed=0,o.loop=t,o}getQueryFunction(...e){let t;return t="number"==typeof e[0]?this.queryWithHandler:this.queryWithCallerAndMethod,t}queryWithHandler(e,t){return e.handler===t}queryWithCallerAndMethod(e,t,s){return e.caller===t&&(!s||e.method===s)}getRemindTime(...e){const t=this.getQueryFunction(...arguments);for(let e=this._handlers.length;e>=0;e--){const s=this._handlers[e];if(t(s,...arguments))return s.duration-s.elapsed}}}}),Re=Object.freeze({__proto__:null,deserialize:De});class Ve{constructor(e){this._stringify=!1,this._minify=!1,this.setOptions(e)}setOptions(e){e&&(this._stringify=e.stringify,this._minify=e.minify)}dump(){let e=this.finalizeJsonPart();if(this._stringify){const t=JSON.stringify(e);return this._minify&&t.replace(/\s/g,""),t}return e}}class ke extends Ve{constructor(){super(...arguments),this.serializedList=new Map}initialize(e){this.serializedList.clear(),this._root=e}finalizeJsonPart(){let e=[];for(const[t,s]of this.serializedList)e.push(s.data);return e}writeRawProperty(e,t,s,r){let i=e[s];t&&(t.data[s]=i)}writeArrayProperty(e,t,s,r){let i={data:[],id:-1};return t&&(t.data[s]=i.data),i}writeDictProperty(e,t,s,r){let i={data:{},id:-1};return t&&(t.data[s]=i.data),i}writeClassProperty(e,t,s,r){let i=e[s],n=this.addObject(i,{__type__:r.type});return t&&(t.data[s]={__id__:n.id}),n}writeBuiltinProperty(e,t,s,r){let i={data:Oe(e[s]),id:-1};return t&&(t.data[s]=i.data),i}addObject(e,t){if(!this.serializedList.has(e)){const s={data:t,id:this.serializedList.size};this.serializedList.set(e,s)}return this.serializedList.get(e)}}class Ue{constructor(e,t){this.initialize(e,t)}initialize(e,t){this._builder=e}parse(e){this._builder.initialize(e),this.parseField(e,"test",{test:e})}parseField(e,t,s,r){let i=typeof e,o=s&&n(s.constructor),l=o?this.getPropertyDefaultValue(s,t):void 0;if(this._doNotStripDefault&&o&&l===e)return!0;let a={defaultValue:l};if(Array.isArray(e))this.parseArrayField(e,t,s,r);else if("string"===i||"number"===i||"boolean"===i||null==e)this._builder.writeRawProperty(s,r,t,a);else if(ze(e.constructor))this.parseTypeValueField(e,t,s,r);else if(oe.is(e,["set","get","has"]))this.parseMapField(e,t,s,r);else if(e instanceof Set)this.parseSetField(e,t,s,r);else{oe.getSuper(e.constructor)?this.parseTSClassField(e,t,s,r):this.parseObjectField(e,t,s,r)}return null}parseTypeValueField(e,t,s,r){const i=oe.getClassName(e);let n=this._builder.writeBuiltinProperty(s,r,t,{type:i});this._builder.writeRawProperty(e,n,"value",{defaultValue:e.toString()})}parseArrayField(e,t,s,r){let i=this._builder.writeArrayProperty(s,r,t,{});for(let t=0;t<e.length;t++)this.parseField(e[t],t,e,i)}parseMapField(e,t,s,r){let i=this._builder.writeBuiltinProperty(s,r,t,{type:"Map"});const n=[...e.keys()],o=[...e.values()];this.parseArrayField(n,"keys",e,i),this.parseArrayField(o,"values",e,i)}parseSetField(e,t,s,r){let i=this._builder.writeBuiltinProperty(s,r,t,{type:"Set"});const n=[...e.values()];this.parseArrayField(n,"values",e,i)}parseTSClassField(e,t,s,r){let i=this._builder.writeClassProperty(s,r,t,{type:oe.getClassName(e)}),n=this.enumerateClass(e);for(let t=0;t<n.length;t++)this.parseField(e[n[t]],n[t],e,i)}parseObjectField(e,t,s,r){let i=this._builder.writeDictProperty(s,r,t,{}),n=this.enumerateClass(e);for(let t=0;t<n.length;t++)this.parseField(e[n[t]],n[t],e,i)}enumerateClass(e){let t;const s=e.constructor;return t=n(s)?s.__props__.concat():Object.keys(e),t}getPropertyDefaultValue(e,t){}}const Qe=new Ue(null,null);var We=Object.freeze({__proto__:null,Builder:Ve,Parser:Ue,serialize:function(e,t){let s=function(e){return new ke(e)}(t);Qe.initialize(s,t);try{Qe.parse(e)}catch(e){return console.error(e),t.stringify?"":{}}return s.dump()}});globalThis.lighter={assets:Ne,controller:Be,decorators:ve,deserialize:Re,serialize:We,util:ce};export { Ne as assets, Be as controller, ve as decorators, Re as deserialize, We as serialize, ce as util };
//# sourceMappingURL=index.js.map
