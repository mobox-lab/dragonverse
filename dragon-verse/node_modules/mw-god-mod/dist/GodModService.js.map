{"version":3,"file":"GodModService.js","sources":["../GodModService.ts"],"sourcesContent":["export * from \"./GodModParam\";\r\nexport * from \"./GodCommandItem\";\r\nexport * from \"./ui/GodModPanel\";\r\nexport * from \"./ui/param-base/GodModParamInputBase\";\r\nexport * from \"./ui/param-base/IGodModParamInput\";\r\nexport * from \"./ui/param-base/IGodModParamValidatorOption\";\r\nexport * from \"./ui/param-input/GodModIntegerParamInput\";\r\nexport * from \"./ui/param-input/GodModNumberParamInput\";\r\nexport * from \"./ui/param-input/GodModStringParamInput\";\r\nexport * from \"./ui/param-input/GodModVectorParamInput\";\r\nexport * from \"./ui/icon/ExpandIcon\";\r\nexport * from \"./ui/icon/MoveIcon\";\r\n\r\nimport { AcceptableParamType, GodCommandParamOption, InferParamType } from \"./GodModParam\";\r\nimport { GodModPanel } from \"./ui/GodModPanel\";\r\nimport Gtk, { GtkTypes, Regulator, Singleton } from \"gtoolkit\";\r\nimport Log4Ts from \"mw-log4ts\";\r\nimport { GodCommandItem } from \"./GodCommandItem\";\r\n\r\nexport type AuthStrategy = \"strong\" | \"weak\";\r\n\r\n/**\r\n * God Mod 服务.\r\n *\r\n * ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟\r\n * ⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄\r\n * ⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄\r\n * ⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄\r\n * ⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n * @author LviatYi\r\n * @font JetBrainsMono Nerd Font Mono https://github.com/ryanoasis/nerd-fonts/releases/download/v3.0.2/JetBrainsMono.zip\r\n * @fallbackFont Sarasa Mono SC https://github.com/be5invis/Sarasa-Gothic/releases/download/v0.41.6/sarasa-gothic-ttf-0.41.6.7z\r\n */\r\nexport default class GodModService extends Singleton<GodModService>() {\r\n//#region Constant\r\n    /**\r\n     * 管理员列表存储键.\r\n     */\r\n    public static readonly GodModAdminListStorageKey\r\n        = \"GOD_MOD_ADMIN_LIST__STORAGE_KEY\";\r\n\r\n    /**\r\n     * God Mod 请求运行 事件名前缀.\r\n     */\r\n    public static readonly GodModRunRequestEventNamePrefix\r\n        = \"__GOD_MOD_RUN_REQUEST_EVENT_NAME__\";\r\n\r\n    /**\r\n     * God Mod 命令于服务端运行完成 事件名.\r\n     */\r\n    public static readonly GodModCommandRunResultInServerEventName\r\n        = \"__GOD_MOD_COMMAND_RUN_RESULT_IN_SERVER__\";\r\n\r\n    /**\r\n     * God Mod 查询权限请求 事件名.\r\n     */\r\n    public static readonly GodModQueryAuthorityReqEventName\r\n        = \"__GOD_MOD_QUERY_AUTHORITY_REQ_EVENT_NAME__\";\r\n\r\n    /**\r\n     * God Mod 查询权限回应 事件名.\r\n     */\r\n    public static readonly GodModQueryAuthorityRespEventName\r\n        = \"__GOD_MOD_QUERY_AUTHORITY_RESP_EVENT_NAME__\";\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n\r\n    private _queriedAdminList: boolean = false;\r\n\r\n    private _view: GodModPanel;\r\n\r\n    /**\r\n     * GodCommands 库.\r\n     * @type {Map<string, GodCommandItem<unknown>>}\r\n     * @private\r\n     */\r\n    private _commands: Map<string, GodCommandItem<any>> = new Map();\r\n\r\n    /**\r\n     * 管理员列表.\r\n     * @type {Set<string>}\r\n     * @private\r\n     */\r\n    private _adminList: Set<string> = undefined;\r\n\r\n    private _shutdown: boolean = false;\r\n\r\n    private _checkAuthorityRegulator: Regulator = new Regulator(GtkTypes.Interval.PerMin * 5);\r\n\r\n    private _currentFrontFocus: string;\r\n\r\n    private _authStrategy: AuthStrategy = \"weak\";\r\n\r\n    public onConstruct() {\r\n        if (mw.SystemUtil.isClient()) {\r\n            mw.Event.addServerListener(\r\n                GodModService.GodModCommandRunResultInServerEventName,\r\n                (event) => {\r\n                    const e = event as GodModCommandRunResult;\r\n                    if (this._currentFrontFocus === e.label) {\r\n                        this.showUiResult(e.result);\r\n                    }\r\n                },\r\n            );\r\n        }\r\n\r\n        if (mw.SystemUtil.isServer()) {\r\n            mw.TimeUtil.onEnterFrame.add(() => {\r\n                if (this._checkAuthorityRegulator.request()) {\r\n                    this.queryAdminList();\r\n                }\r\n            });\r\n\r\n            mw.Event.addClientListener(\r\n                GodModService.GodModQueryAuthorityReqEventName,\r\n                player => {\r\n                    mw.Event.dispatchToClient(player,\r\n                        GodModService.GodModQueryAuthorityRespEventName,\r\n                        this.verifyAuthority(player.userId));\r\n                });\r\n        }\r\n    }\r\n\r\n    public addCommand<P extends AcceptableParamType>(label: string,\r\n                                                     paramType: P = \"string\" as P,\r\n                                                     clientCmd: (params: InferParamType<P>) => void = undefined,\r\n                                                     serverCmd: (player: mw.Player, params: InferParamType<P>) => void = undefined,\r\n                                                     paramOption: GodCommandParamOption<InferParamType<P>> = undefined,\r\n                                                     group?: string) {\r\n        if (this._shutdown) return;\r\n\r\n        if (this._commands.get(label)) {\r\n            Log4Ts.error(GodModService,\r\n                `A command with the same label already exists.`,\r\n                label);\r\n        } else if (!clientCmd && !serverCmd) {\r\n            Log4Ts.error(\r\n                GodModService,\r\n                `at least one of the client command and server command must be provided.`);\r\n        } else {\r\n            this._commands.set(label, new GodCommandItem(label,\r\n                paramType,\r\n                clientCmd,\r\n                serverCmd,\r\n                paramOption,\r\n                group));\r\n            if (mw.SystemUtil.isServer()) {\r\n                mw.Event.addClientListener(\r\n                    this.getEventName(label),\r\n                    (player: mw.Player, p: any) => {\r\n                        this.runCommandInServer(player, label, p);\r\n                    });\r\n            }\r\n        }\r\n    }\r\n\r\n    public removeCommand(label: string) {\r\n        this._commands.delete(label);\r\n    }\r\n\r\n    public getAllCommands(): Readonly<GodCommandItem<AcceptableParamType>[]> {\r\n        return [...this._commands.values()];\r\n    }\r\n\r\n    public runCommandInClient(label: string,\r\n                              p: any,\r\n                              autoDispatchToServer: boolean = true) {\r\n        if (this._shutdown || !mw.SystemUtil.isClient()) return;\r\n        const command = this._commands.get(label);\r\n        if (!command || !command.isParamValid(p)) return;\r\n\r\n        this._currentFrontFocus = label;\r\n        Log4Ts.log(GodModService,\r\n            `run command in client.`,\r\n            `command: ${this._currentFrontFocus}`);\r\n\r\n        let result = false;\r\n        try {\r\n            let r = command.clientCmd?.(p);\r\n            if (r !== false) result = true;\r\n        } catch (e) {\r\n            Log4Ts.error(GodModService,\r\n                `error occurs in client command.`,\r\n                e);\r\n        }\r\n\r\n        if (command.serverCmd && autoDispatchToServer) {\r\n            Event.dispatchToServer(this.getEventName(command.label), p);\r\n        } else {\r\n            this.showUiResult(result);\r\n        }\r\n    }\r\n\r\n    public runCommandInServer(player: mw.Player,\r\n                              label: string,\r\n                              p: any) {\r\n        if (this._shutdown || !mw.SystemUtil.isServer()) return;\r\n        if (!this.verifyAuthority(player.userId)) return;\r\n        const command = this._commands.get(label);\r\n        if (!command || !command.isParamValid(p)) return;\r\n\r\n        Log4Ts.log(GodModService,\r\n            `run command in server.`,\r\n            `command: ${this._currentFrontFocus}`,\r\n            `by user: ${player.userId}`);\r\n\r\n        let result = false;\r\n        try {\r\n            let r = command.serverCmd?.(player, p);\r\n            if (r !== false) result = true;\r\n            Event.dispatchToClient(player,\r\n                GodModService.GodModCommandRunResultInServerEventName,\r\n                {label: label, result} as GodModCommandRunResult);\r\n        } catch (e) {\r\n            Log4Ts.error(GodModService,\r\n                `error occurs in server command.`,\r\n                e);\r\n            Event.dispatchToClient(player,\r\n                GodModService.GodModCommandRunResultInServerEventName,\r\n                {label: label, result: false} as GodModCommandRunResult);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 显示 God Mod 面板.\r\n     */\r\n    public showGm() {\r\n        if (mw.SystemUtil.isClient()) {\r\n            if (!this._view) {\r\n                this._view = GodModPanel\r\n                    .create({\r\n                        items: Array.from(this._commands.values()),\r\n                        zOrder: 650000,\r\n                    })\r\n                    .attach(mw.UIService.canvas)\r\n                    .registerCommandHandler((label, p, autoDispatchToServer) => {\r\n                        this.runCommandInClient(label, p, autoDispatchToServer);\r\n                    });\r\n            } else {\r\n                this._view.attach(mw.UIService.canvas);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 隐藏 God Mod 面板.\r\n     */\r\n    public hideGm() {\r\n        if (mw.SystemUtil.isClient()) {\r\n            this._view?.detach();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 带权限验证地 显示 God Mod 面板.\r\n     * @desc 使用服务器的 权限认证策略.\r\n     * @desc 当 PIE 环境时 无论如何将直接显示.\r\n     */\r\n    public authShowGm() {\r\n        if (mw.SystemUtil.isPIE) this.showGm();\r\n\r\n        if (mw.SystemUtil.isClient()) {\r\n            this.hasAuthority()\r\n                .then(value => {\r\n                    if (value) this.showGm();\r\n                    else this.hideGm();\r\n                });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 关闭 God Mod 服务.\r\n     * @desc 执行后不再生效.\r\n     */\r\n    public shutdown(): this {\r\n        this._shutdown = true;\r\n        this._commands.clear();\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 设置服务器 权限验证策略.\r\n     * @param {AuthStrategy} strategy\r\n     *  - \"strong\" 强权限验证.\r\n     *    仅手动添加到管理员列表的用户可使用.\r\n     *  - \"weak\" 弱权限验证.\r\n     *    若不存在管理员列表则所有用户可使用.\r\n     *    否则仅手动添加到管理员列表的用户可使用.\r\n     * @return {this}\r\n     */\r\n    public setAuthStrategy(strategy: AuthStrategy): this {\r\n        this._authStrategy = strategy;\r\n        return this;\r\n    }\r\n\r\n//#region UI Config\r\n    /**\r\n     * 设置 GodMod 面板 zOrder.\r\n     * @param {number} zOrder\r\n     * @return {this}\r\n     */\r\n    public setZOrder(zOrder: number): this {\r\n        if (this._view && this._view.root) {\r\n            this._view.root.zOrder = zOrder;\r\n        }\r\n        return this;\r\n    }\r\n\r\n    /**\r\n     * 设置 GodMod 面板 位置.\r\n     * @param {number} x\r\n     * @param {number} y\r\n     * @return {this}\r\n     */\r\n    public setPosition(x: number, y: number): this {\r\n        if (this._view && this._view.root) {\r\n            Gtk.setUiPosition(this._view.root, x, y);\r\n        }\r\n        return this;\r\n    }\r\n\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n\r\n    /**\r\n     * 是否 具有权限.\r\n     * @desc 仅服务端.\r\n     * @param {string} userId\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    private verifyAuthority(userId: string): boolean {\r\n        switch (this._authStrategy) {\r\n            case \"weak\":\r\n                return this.verifyStrongAuthority(userId);\r\n            case \"strong\":\r\n            default:\r\n                return this.verifyWeakAuthority(userId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 是否 具有弱认证权限.\r\n     * @desc 仅服务端.\r\n     * @param {string} userId\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    private verifyWeakAuthority(userId: string): boolean {\r\n        return this._adminList === undefined || (this._adminList && this._adminList.has(userId));\r\n    }\r\n\r\n    /**\r\n     * 是否 具有强认证权限.\r\n     * @desc 仅服务端.\r\n     * @param {string} userId\r\n     * @return {boolean}\r\n     * @private\r\n     */\r\n    private verifyStrongAuthority(userId: string): boolean {\r\n        return this._adminList?.has(userId) ?? false;\r\n    }\r\n\r\n    /**\r\n     * 是否 自身具有认证权限.\r\n     * @desc 仅客户端.\r\n     * @desc 需服务器手动加入后生效.\r\n     * @return {Promise<boolean>}\r\n     */\r\n    public async hasAuthority(): Promise<boolean> {\r\n        if (!mw.SystemUtil.isClient()) {\r\n            return false;\r\n        }\r\n\r\n        return new Promise((resolve, reject) => {\r\n            const listener = mw.Event.addServerListener(\r\n                GodModService.GodModQueryAuthorityRespEventName,\r\n                (result) => {\r\n                    listener.disconnect();\r\n                    resolve(result as boolean);\r\n                },\r\n            );\r\n            mw.setTimeout(() => {\r\n                    listener.disconnect();\r\n                    reject();\r\n                },\r\n                GtkTypes.Interval.PerSec * 3);\r\n\r\n            mw.Event.dispatchToServer(GodModService.GodModQueryAuthorityReqEventName);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * 查询管理员列表.\r\n     */\r\n    private queryAdminList() {\r\n        mw.DataStorage\r\n            ?.asyncGetData(GodModService.GodModAdminListStorageKey)\r\n            ?.then(result => {\r\n                    if (this._queriedAdminList) return;\r\n\r\n                    switch (result.code) {\r\n                        case mw.DataStorageResultCode.Success:\r\n                            if (result.data === undefined) {\r\n                                mw.DataStorage.asyncSetData(GodModService.GodModAdminListStorageKey, []);\r\n                            } else {\r\n                                if ((result.data as string[])?.length > 0 ?? false) {\r\n                                    this._adminList = new Set();\r\n                                    for (const d of result.data) {\r\n                                        this._adminList.add(d);\r\n                                    }\r\n                                } else {\r\n                                    this._adminList = undefined;\r\n                                }\r\n                            }\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }\r\n\r\n                    this._queriedAdminList = true;\r\n                },\r\n            );\r\n    };\r\n\r\n    /**\r\n     * 获取填充类型名.\r\n     * @param {string} label\r\n     * @return {string}\r\n     * @private\r\n     */\r\n    private getEventName(label: string): string {\r\n        return GodModService.GodModRunRequestEventNamePrefix + label;\r\n    }\r\n\r\n    /**\r\n     * 显示执行反馈结果。\r\n     * @param {boolean} result\r\n     * @private\r\n     */\r\n    private showUiResult(result: boolean) {\r\n        if (result) this._view?.showSuccess();\r\n        else this._view?.showError();\r\n    }\r\n}\r\n\r\nexport function addGMCommand<P extends AcceptableParamType>(\r\n    label: string,\r\n    paramType: P,\r\n    clientCmd: (params: InferParamType<P>) => void = undefined,\r\n    serverCmd: (player: mw.Player, params: InferParamType<P>) => void = undefined,\r\n    paramOption: GodCommandParamOption<InferParamType<P>> = undefined,\r\n    group?: string) {\r\n    GodModService.getInstance().addCommand(label,\r\n        paramType,\r\n        clientCmd,\r\n        serverCmd,\r\n        paramOption,\r\n        group);\r\n}\r\n\r\n/**\r\n * God Mod Command 运行结果.\r\n */\r\ninterface GodModCommandRunResult {\r\n    label: string;\r\n\r\n    result: boolean;\r\n}"],"names":[],"mappings":"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"}