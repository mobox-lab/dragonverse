---
export_on_save:
  puppeteer: true
---

# Dragon Verse | Req Ana

Dragon Verse 需求分析及设计文档

v0.8.2b  
by LviatYi

阅读该文档时，推荐安装以下字体：

- [JetBrainsMono Nerd Font Mono][JetbrainsMonoNerdFont]
- [Sarasa Mono SC][SarasaMonoSC]

若出现乱码，其为 Nerd Font 的特殊字符，不影响段落语义。

## Origin ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄

[策划需求文档][dragon-verse-case]

## Module ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄

模块是游戏功能的抽象性概括，与 mw Module 无关。

---

### 认证

**认证 (Auth)** 模块用于用户 Code 验证，验证以开放 **权限**。

Auth 通过 Https 通信向远端验证 api，这需要与服务端配合。

**权限** 是一组 状态、物品或功能 的集合，其能够被 **给予** 或 **收回**，分别对应两种行为，其拥有其他任何模块的物品及状态的增删能力。

#### 权限

> **0.25MD** +0.25MD

- 准入权限
  - 允许玩家使用自己创建的形象.
  - 给予宠物龙
  - UI 与功能解锁
  - 允许出新手村 空气墙颜色变为绿色
  - 关闭 Code 验证功能

#### 认证 UI

> **0.25MD** +0.25MD

- 文本输入框
- 提交按钮
- 等待动画
- 错误提示
- 超时提示
- 成功提示

---

### 形象

**形象 (Avatar)** 模块用于形象数据维护。

---

### 玩家

**玩家控制器** 模块用于控制玩家行为，包括但不限于：

- 玩家状态处理。
  - 行动能力
  - 状态管理器
  - 姿态动画
- 行动处理
  - 移动
  - 交互

---

### 龙

**龙 (Dragon)** 模块用于管理龙的所有数据。

龙对象 是一个拥有自主跟随能力的物体，其能够跟随玩家的位置而移动。

龙模块 将控制龙的行为，包括但不限于：

- 龙状态处理。
  - 行动能力
  - 状态管理器
  - 姿态动画
- 智能
  - 接入行为树的行为管理

#### 龙 运动模块

运动模块 是龙的一个子模块，用于控制龙的运动轨迹。

其输入玩家位置、其他龙位置信息，输出平滑的自身预期 transform，并进行到该节点。

#### 龙 行为模块

行为模块 是龙的一个子模块，用于控制龙的行为表现。

其输入行为树所输出的状态，输出对应的行为表现，包括但不限于：

- 目标姿态动画

---

### 交互

**交互 (Interaction)** 模块用于处理玩家与交互物的交互行为。

交互物指达成某些条件后触发固定演出并提供交互决策选项的物体。

交互模块 将控制交互物 UI 与交互操作，包括但不限于：

- UI 状态处理。
- 玩家状态管理。
- 交互物通信。

---

### 采集物

> **0.5MD** +0.25MD 采集物数据层.  
> **0.5MD** +0.25MD 采集物生成.  
> **1MD** +0.25MD 采集物交互及 UI.

采集物是一种交互物，其可被玩家 **采集**，采集 将触发采集演出。采集物有不同类型。每种类型和存在多个 **采集物实例**。

- **ID** Id
  - 采集物主键。
- **品质** Quality
  - 采集物的附带标签，允许在不同的场景中进行区分。
  - 不同品质的采集物 **推荐 RECOMMENDED** 作为不同的采集物。
- **生成范围** GenerationRange
  - 采集物生成的坐标范围，采集物实例将在该范围内的随机坐标点生成。
  - 生成范围是一个一维数组，其中保存 **区域 ID**。
  - 区域 中的 Range 属性是一个二维数组。
  - [[x11,y11,x12,y12,x13,y13...x1m,y1m],[x21,y21,x22,y22,x23,y23...x2n,y2n]...]
    > ![生成范围数据意义](pic/generationRange.png)
  - 建议使用凸多边形，可以降低算法开发成本。
- **最大存在数量** MaxExistence
  - 采集物所生成的实例 在整个世界地图中 最大同时存在数量。
- **存在时间** ExistenceTime
  - 采集物实例的存在时间。
  - 达到存在时间时采集物将销毁。
- **刷新间隔** RefreshInterval
  - 与 上一次同种采集物的 刷新时间的 间隔。
- **采集成功率** SuccessRate
  - 玩家采集行为结果为成功的概率。
- **可采集次数** HitPoint
  - 采集物实例可被采集的总次数。
  - 当玩家 **成功采集** 时 -1，当 0 时采集物。
  - 所有玩家共享的，可被竞争的。
  <!-- - **可采集总次数** GlobalHitPoint
  - 采集物所有实例累计可被采集的次数。
  - 超过该次数将不会再刷出。 -->
- **采集结果** Result
  - 采集结果行为标识符.
  - 是一串 string.
  - SCREAMING_SNAKE_CASE 命名法.
  - 由程序定义采集结果.
  - 需要分表配合.
  <!-- - **刷新时间** GenerationTimeRange
  - 指定的时间段内才会触发刷新。 -->

程序侧预定义配置表:  
[采集物 CollectibleItem | Dragon Verse | Tables][dragon-verse-tables-collectible]  
[区域 Area | Dragon Verse | Tables][dragon-verse-tables-area]

### 可捕捉龙

> **0.5MD** +0.25MD 采集物数据层.  
> **0.5MD** +0.25MD 采集物生成.  
> **1MD** +0.25MD 采集物交互及 UI.

可捕捉龙 是一种交互物，其可被玩家 **捕捉**，捕捉 将触发捕捉演出。可捕捉龙有不同类型。每种类型和存在多个 **可捕捉龙实例**。

#### 捕捉

当玩家满足待捕捉条件时，进入 **待捕捉态**：

- 弹出 捕捉 UI。

玩家通过 UI 选择指定的 可捕捉龙 后，可点击捕捉按钮：

- 判定是否捕捉成功。
  - 成功
    - 消耗一个 DragonBall。
    - 销毁 可捕捉龙。
    - 加入玩家背包。
  - 不可抗力失败
    - 提示原因。
  - 失败
    - 消耗一个 DragonBall。

#### 可捕捉龙 行为

可捕捉龙具有两种状态：

- **待机** Idle 无目的 默认的
  - 呼吸
  - 休闲
- **闲逛** Stroll 通过自动寻路确立一个目的地
  - 行走
  - 奔跑

Idle 一段时间后进入 Stroll。 Stroll 达到目的地后进入 Idle。

---

### 背包

**背包 (Bag)** 模块用于存储玩家被给予的任何存在。同时提供一个可供交互的 UI 界面，用于展示被给予的、可被观察的存在。

**存在** 包括但不限于：

- 权限所影响的全局状态。
- 收集的物品。

#### 背包数据

- 金币
- 背包物品

---

### 图鉴

**图鉴 HandBook** 模块记录玩家已经达成的目标点。其提供一个用于展示的 UI 界面。

图鉴可以记录：

- 已捕捉龙

---

### 子游戏

UNKNOWN INCLUDE ALL.

## Technology ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄

---

### Https 通信

需要调用 Https Api，进行与服务提供者的交流。

---

### 行为树

行为树模块，用于定义可复用 AI。

[JetbrainsMonoNerdFont]: https://github.com/ryanoasis/nerd-fonts/releases/download/v3.0.2/JetBrainsMono.zip@fallbackFont
[SarasaMonoSC]: https://github.com/be5invis/Sarasa-Gothic/releases/download/v0.41.6/sarasa-gothic-ttf-0.41.6.7z
[dragon-verse-case]: https://brainvat.sg.larksuite.com/wiki/JhMbw2RmjiNDGPkL7fglaojrgEc
[dragon-verse-tables-collectible]: ./tables.md#采集物-collectibleitem
[dragon-verse-tables-area]: ./tables.md#区域-Area
