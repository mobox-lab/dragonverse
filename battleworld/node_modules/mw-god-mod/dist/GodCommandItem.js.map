{"version":3,"file":"GodCommandItem.js","sources":["../GodCommandItem.ts"],"sourcesContent":["import { pinyin } from \"pinyin-pro\";\r\nimport { AcceptableParamType, GodCommandParamOption, InferParamType } from \"./GodModParam\";\r\nimport Log4Ts from \"mw-log4ts\";\r\n\r\n/**\r\n * God Command Item 命令项.\r\n * @desc 描述一个 God 命令.\r\n */\r\nexport class GodCommandItem<P extends AcceptableParamType> {\r\n    public pinyin: string;\r\n\r\n    /**\r\n     * God Command Item constructor.\r\n     * @param {string} label 名称. 唯一的.\r\n     * @param {P} paramType 参数类型.\r\n     * @param {(params: P) => void} clientCmd client 命令.\r\n     * @param {(player: mw.Player, params: P) => void} serverCmd server 命令.\r\n     * @param {GodCommandParamOption<P>} paramOption 参数选项.\r\n     * @param {string} group 分组.\r\n     */\r\n    public constructor(public label: string,\r\n                       public paramType: P,\r\n                       public clientCmd?: (params: InferParamType<P>) => boolean | void,\r\n                       public serverCmd?: (player: mw.Player, params: InferParamType<P>) => boolean | void,\r\n                       public paramOption?: GodCommandParamOption<InferParamType<P>>,\r\n                       public group?: string) {\r\n        this.pinyin = pinyin(\r\n            label,\r\n            {\r\n                type: \"string\",\r\n                separator: \"\",\r\n                toneType: \"none\",\r\n                v: true,\r\n            });\r\n    }\r\n\r\n    /**\r\n     * 是否 󰍹客户端命令.\r\n     * @return {boolean}\r\n     */\r\n    public get isClientCmd(): boolean {\r\n        return !!this.clientCmd;\r\n    }\r\n\r\n    /**\r\n     * 是否 󰒋服务器命令.\r\n     * @return {boolean}\r\n     */\r\n    public get isServerCmd(): boolean {\r\n        return !!this.serverCmd;\r\n    }\r\n\r\n    /**\r\n     * 是否通过 󰄲数据验证.\r\n     * @param {P} p\r\n     * @return {boolean} 是否 通过验证.\r\n     */\r\n    public isParamValid(p: InferParamType<P>): boolean {\r\n        if (isNullOrUndefined(this.paramOption?.validator)) return true;\r\n\r\n        for (const validator of this.paramOption.validator) {\r\n            try {\r\n                if (typeof validator === \"function\") {\r\n                    if (!validator(p)) return false;\r\n                } else {\r\n                    if (!validator?.validator(p)) return false;\r\n                    //TODO_LviatYi Reason Output.\r\n                }\r\n            } catch (e) {\r\n                Log4Ts.error(GodCommandItem,\r\n                    `error occurs in validator.`,\r\n                    e);\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction isNullOrUndefined(p: unknown): boolean {\r\n    return p == undefined;\r\n}"],"names":[],"mappings":";;;AAIA;;;AAGG;MACU,cAAc,CAAA;AAGvB;;;;;;;;AAQG;IACH,WAA0B,CAAA,KAAa,EACb,SAAY,EACZ,SAAyD,EACzD,SAA4E,EAC5E,WAAsD,EACtD,KAAc,EAAA;QALd,IAAK,CAAA,KAAA,GAAL,KAAK,CAAQ;QACb,IAAS,CAAA,SAAA,GAAT,SAAS,CAAG;QACZ,IAAS,CAAA,SAAA,GAAT,SAAS,CAAgD;QACzD,IAAS,CAAA,SAAA,GAAT,SAAS,CAAmE;QAC5E,IAAW,CAAA,WAAA,GAAX,WAAW,CAA2C;QACtD,IAAK,CAAA,KAAA,GAAL,KAAK,CAAS;AACpC,QAAA,IAAI,CAAC,MAAM,GAAG,MAAM,CAChB,KAAK,EACL;AACI,YAAA,IAAI,EAAE,QAAQ;AACd,YAAA,SAAS,EAAE,EAAE;AACb,YAAA,QAAQ,EAAE,MAAM;AAChB,YAAA,CAAC,EAAE,IAAI;AACV,SAAA,CAAC,CAAC;KACV;AAED;;;AAGG;AACH,IAAA,IAAW,WAAW,GAAA;AAClB,QAAA,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;KAC3B;AAED;;;AAGG;AACH,IAAA,IAAW,WAAW,GAAA;AAClB,QAAA,OAAO,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;KAC3B;AAED;;;;AAIG;AACI,IAAA,YAAY,CAAC,CAAoB,EAAA;AACpC,QAAA,IAAI,iBAAiB,CAAC,IAAI,CAAC,WAAW,EAAE,SAAS,CAAC;AAAE,YAAA,OAAO,IAAI,CAAC;QAEhE,KAAK,MAAM,SAAS,IAAI,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE;AAChD,YAAA,IAAI;AACA,gBAAA,IAAI,OAAO,SAAS,KAAK,UAAU,EAAE;AACjC,oBAAA,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;AAAE,wBAAA,OAAO,KAAK,CAAC;iBACnC;qBAAM;AACH,oBAAA,IAAI,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC,CAAC;AAAE,wBAAA,OAAO,KAAK,CAAC;;iBAE9C;aACJ;YAAC,OAAO,CAAC,EAAE;gBACR,MAAM,CAAC,KAAK,CAAC,cAAc,EACvB,CAA4B,0BAAA,CAAA,EAC5B,CAAC,CAAC,CAAC;AACP,gBAAA,OAAO,KAAK,CAAC;aAChB;SACJ;AAED,QAAA,OAAO,IAAI,CAAC;KACf;AACJ,CAAA;AAED,SAAS,iBAAiB,CAAC,CAAU,EAAA;IACjC,OAAO,CAAC,IAAI,SAAS,CAAC;AAC1B;;;;"}