{"version":3,"file":"Avatar.js","sources":["../../component/Avatar.ts"],"sourcesContent":["import Log4Ts from \"mw-log4ts\";\r\nimport Gtk, { Delegate } from \"gtoolkit\";\r\nimport { Property, PropertyUtil } from \"../style/Property\";\r\nimport { Component, ComponentOption } from \"./Component\";\r\nimport { Lui } from \"../style/Asset\";\r\nimport { ClickEvent } from \"../event/ClickEvent\";\r\nimport SlateVisibility = mw.SlateVisibility;\r\nimport SimpleDelegate = Delegate.SimpleDelegate;\r\nimport ColorUtil = Lui.Asset.ColorUtil;\r\nimport Color = Lui.Asset.Color;\r\nimport NormalThemeColor = Lui.Asset.NormalThemeColor;\r\nimport Interval = Lui.Asset.Interval;\r\nimport ThemeColor = Lui.Asset.ThemeColor;\r\n\r\n/**\r\n * Avatar.\r\n *\r\n * ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟\r\n * ⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄\r\n * ⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄\r\n * ⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄\r\n * ⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n * @author LviatYi\r\n * @font JetBrainsMono Nerd Font Mono https://github.com/ryanoasis/nerd-fonts/releases/download/v3.0.2/JetBrainsMono.zip\r\n * @fallbackFont Sarasa Mono SC https://github.com/be5invis/Sarasa-Gothic/releases/download/v0.41.6/sarasa-gothic-ttf-0.41.6.7z\r\n */\r\nexport class Avatar extends Component {\r\n    private _circleMasks: mw.Canvas[];\r\n\r\n    private get realRoot(): mw.Canvas {\r\n        return this._circleMasks?.[(this._circleMasks?.length ?? 0) - 1] ?? this.root;\r\n    }\r\n\r\n    private _imgBgIcon: mw.Image;\r\n\r\n    private _btnIcon: mw.Button;\r\n\r\n    private _cnvClickAnim: mw.Canvas;\r\n\r\n    private _imgClickAnim: mw.Image;\r\n\r\n    private _imgHighlight: mw.Image;\r\n\r\n    private _txtLabel: mw.TextBlock;\r\n\r\n    private _option: Readonly<Required<AvatarOption>> = undefined;\r\n\r\n    private _hovered: boolean = false;\r\n\r\n//#region Lui Component\r\n    public static create(option?: AvatarOption): Avatar {\r\n        let avatar = new Avatar();\r\n\r\n        if (avatar._option.zOrder !== undefined)\r\n            avatar.root.zOrder = avatar._option.zOrder;\r\n\r\n        avatar._option = Avatar.defaultOption(option);\r\n        if (avatar._option.variant === \"circle\") {\r\n            let precision = PropertyUtil.getMaskPrecisionByEffectLevel(avatar._option.effectLevel);\r\n            avatar._circleMasks = [];\r\n            let lastMask = avatar.root;\r\n            let angle = 90 / precision;\r\n            for (let i = 0; i < precision; ++i) {\r\n                lastMask = mw.Canvas.newObject(lastMask, `mask${i}`);\r\n                lastMask.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n                lastMask.clipEnable = true;\r\n                lastMask.renderTransformAngle = avatar._circleMasks.length === 0 ? angle - 90 : angle;\r\n\r\n                avatar._circleMasks.push(lastMask);\r\n            }\r\n        }\r\n\r\n        let realRoot = avatar.realRoot;\r\n        avatar._imgBgIcon = mw.Image.newObject(realRoot, \"imgBgIcon\");\r\n        Gtk.setUiPosition(avatar._imgBgIcon, 1, 1);\r\n        avatar._imgBgIcon.imageGuid = avatar._option.variant === \"circle\" ?\r\n            Lui.Asset.ImgCircle :\r\n            Lui.Asset.ImgRectangle;\r\n\r\n        avatar._btnIcon = mw.Button.newObject(realRoot, \"btnIcon\");\r\n        Gtk.setUiPosition(avatar._btnIcon, 1, 1);\r\n        avatar._btnIcon.visibility = mw.SlateVisibility.Visible;\r\n        if (avatar._option.labelIcon) {\r\n            avatar._btnIcon.normalImageGuid = avatar._option.labelIcon;\r\n            avatar._btnIcon.normalImageDrawType = mw.SlateBrushDrawType.Image;\r\n        } else {\r\n            avatar._btnIcon.normalImageDrawType = mw.SlateBrushDrawType.NoDrawType;\r\n        }\r\n        avatar._btnIcon.transitionEnable = false;\r\n        avatar._btnIcon.setNormalImageColorByHex(ColorUtil.colorHexWithAlpha(Color.White, 1));\r\n\r\n        avatar._cnvClickAnim = mw.Canvas.newObject(realRoot, \"cnvClickAnim\");\r\n        Gtk.setUiPosition(avatar._cnvClickAnim, 1, 1);\r\n        avatar._cnvClickAnim.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n        avatar._cnvClickAnim.clipEnable = true;\r\n\r\n        avatar._imgClickAnim = mw.Image.newObject(avatar._cnvClickAnim, \"imgClickAnim\");\r\n        avatar._imgClickAnim.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n        Gtk.setUiScale(avatar._imgClickAnim, 0, 0);\r\n        avatar._imgClickAnim.renderOpacity = 0;\r\n        avatar._imgClickAnim.imageGuid = Lui.Asset.ImgCircle;\r\n        avatar._imgClickAnim.setImageColorByHex(ColorUtil.colorHexWithAlpha(Color.Black, 0.25));\r\n\r\n        avatar._imgHighlight = mw.Image.newObject(avatar.root, \"imgHighlight\");\r\n        Gtk.setUiPosition(avatar._imgHighlight, 1, 1);\r\n        avatar._imgHighlight.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n        avatar._imgHighlight.imageGuid = Lui.Asset.ImgRectangle;\r\n        avatar._imgHighlight.setImageColorByHex(ColorUtil.colorHexWithAlpha(Color.White, 0.2));\r\n        avatar._imgHighlight.renderOpacity = 0;\r\n\r\n        avatar._txtLabel = mw.TextBlock.newObject(avatar.root, \"txtLabel\");\r\n        Gtk.setUiPosition(avatar._txtLabel, 1, 1);\r\n        avatar._txtLabel.visibility = mw.SlateVisibility.SelfHitTestInvisible;\r\n        avatar._txtLabel.autoAdjust = false;\r\n        PropertyUtil.applyFontSize(avatar._txtLabel, option.fontSize);\r\n        avatar._txtLabel.glyph = option.fontStyle;\r\n        avatar._txtLabel.textAlign = mw.TextJustify.Center;\r\n        avatar._txtLabel.textVerticalAlign = mw.TextVerticalJustify.Center;\r\n\r\n        avatar.setSize();\r\n        avatar.setColor();\r\n        avatar.setAvatarLabel();\r\n\r\n        avatar._btnIcon.onClicked.add(() => {\r\n            const clickAt = mw.absoluteToLocal(\r\n                avatar.root.cachedGeometry,\r\n                mw.getMousePositionOnPlatform());\r\n            avatar.playClickAnimAt(clickAt.x, clickAt.y);\r\n            avatar._hovered = false;\r\n\r\n            try {\r\n                avatar.onClick.invoke({position: {x: clickAt.x, y: clickAt.y}});\r\n            } catch (e) {\r\n                Log4Ts.error(Avatar, `error occurs in onClick.`, e);\r\n            }\r\n        });\r\n\r\n        avatar._btnIcon.onHovered.add(() => {\r\n            if (avatar._imgClickAnim.renderOpacity <= 0) avatar._hovered = true;\r\n        });\r\n        avatar._btnIcon.onUnhovered.add(() => avatar._hovered = false);\r\n\r\n        mw.TimeUtil.onEnterFrame.add(avatar.renderAnimHandler);\r\n        return avatar;\r\n    };\r\n\r\n    public static defaultOption(option?: AvatarOption): Required<AvatarOption> {\r\n        if (!option) option = {};\r\n\r\n        if (!option.size) option.size = 40;\r\n        if (!option.labelText) option.labelText = \"\";\r\n        if (!option.labelIcon || option.labelIcon === \"\") option.labelIcon = undefined;\r\n        if (!option.color) option.color = NormalThemeColor;\r\n        if (!option.fontSize) option.fontSize = 18;\r\n        if (!option.fontStyle) option.fontStyle = mw.UIFontGlyph.Light;\r\n        if (!option.variant) option.variant = \"circle\";\r\n        if (!option.effectLevel) option.effectLevel = \"medium\";\r\n\r\n        return option as Required<AvatarOption>;\r\n    };\r\n\r\n    protected renderAnimHandler = (dt: number) => {\r\n        if (this._imgClickAnim.renderOpacity > 0) {\r\n            let scale = Math.min(1, this._imgClickAnim.renderScale.x + dt / Interval.Fast);\r\n            Gtk.setUiScale(this._imgClickAnim, scale, scale);\r\n            this._imgClickAnim.renderOpacity = Math.max(0, this._imgClickAnim.renderOpacity - dt / Interval.Normal);\r\n        }\r\n\r\n        if (this._hovered && this._imgHighlight.renderOpacity < 1) {\r\n            this._imgHighlight.renderOpacity = Math.min(1, this._imgHighlight.renderOpacity + dt / Interval.VeryFast);\r\n        }\r\n\r\n        if (!this._hovered && this._imgHighlight.renderOpacity > 0) {\r\n            this._imgHighlight.renderOpacity = Math.max(0, this._imgHighlight.renderOpacity - dt / Interval.VeryFast);\r\n        }\r\n    };\r\n\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n\r\n//#region Init\r\n    private setSize(): this {\r\n        let size = this._option.size;\r\n\r\n        Gtk.setUiSize(this.root, size, size);\r\n\r\n        if (this._circleMasks) {\r\n            for (let i = 0; i < this._circleMasks.length; i++) {\r\n                const mask = this._circleMasks[i];\r\n                Gtk.setUiSize(mask, size + 2, size + 2);\r\n                if (i === 0) {\r\n                    Gtk.setUiPosition(mask, -1, -1);\r\n                } else {\r\n                    Gtk.setUiPosition(mask, 0, 0);\r\n                }\r\n            }\r\n        }\r\n\r\n        Gtk.setUiSize(this._imgBgIcon, size, size);\r\n        Gtk.setUiSize(this._cnvClickAnim, size, size);\r\n        Gtk.setUiSize(this._btnIcon, size, size);\r\n        Gtk.setUiSize(this._txtLabel, size, size);\r\n        Gtk.setUiSize(this._imgHighlight, size, size);\r\n\r\n        const diameter = this._option.variant === \"square\" ?\r\n            2 * Math.sqrt(size * size * 2) :\r\n            2 * size;\r\n        Gtk.setUiSize(this._imgClickAnim, diameter, diameter);\r\n\r\n        return this;\r\n    }\r\n\r\n    private setColor(): this {\r\n        this._imgBgIcon.setImageColorByHex(ColorUtil.colorHexWithAlpha(this._option.color.primary, 1));\r\n        if (ColorUtil.isBrightness(this._imgBgIcon.imageColor.r,\r\n            this._imgBgIcon.imageColor.g,\r\n            this._imgBgIcon.imageColor.b)) {\r\n            this._txtLabel.setFontColorByHex(ColorUtil.colorHexWithAlpha(Color.Black, 1));\r\n        } else {\r\n            this._txtLabel.setFontColorByHex(ColorUtil.colorHexWithAlpha(Color.White, 1));\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    private setAvatarLabel(): this {\r\n        if (this._option.labelIcon) {\r\n            this._txtLabel.visibility = SlateVisibility.Collapsed;\r\n        } else {\r\n            this._txtLabel.visibility = SlateVisibility.SelfHitTestInvisible;\r\n            let text = this._option.labelText;\r\n            let shown: string;\r\n            if (!text || text.length === 0) {\r\n                shown = \"\";\r\n            } else if (/^[a-zA-Z0-9 ]+$/.test(text)) {\r\n                let words = text.split(\" \").filter(word => word.length > 0);\r\n                if (words.length > 1) {\r\n                    words.length = 2;\r\n                    shown = words.map(word => word.slice(0, 1).toUpperCase()).join(\"\");\r\n                } else {\r\n                    text = words[0];\r\n                    shown = text.match(/[A-Z]/g)?.slice(0, 2).join(\"\") ?? text.slice(0, 1).toUpperCase();\r\n                }\r\n            } else {\r\n                shown = text.match(/\\S/)[0];\r\n            }\r\n            Gtk.trySetText(this._txtLabel, shown);\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n\r\n    private playClickAnimAt(x: number, y: number) {\r\n        Gtk.setUiScale(this._imgClickAnim, 0, 0);\r\n        this._imgClickAnim.renderOpacity = 1;\r\n\r\n        Gtk.setUiPosition(this._imgClickAnim,\r\n            x - this._imgClickAnim.size.x / 2,\r\n            y - this._imgClickAnim.size.y / 2);\r\n    }\r\n\r\n    public preview(): this {\r\n        Gtk.setUiScale(this._imgClickAnim, 0.5, 0.5);\r\n        this._imgClickAnim.renderOpacity = 0.75;\r\n\r\n        Gtk.setUiPosition(this._imgClickAnim,\r\n            this._btnIcon.position.x + this._btnIcon.size.x - this._imgClickAnim.size.x / 2,\r\n            this._btnIcon.position.y + this._btnIcon.size.y - this._imgClickAnim.size.y / 2);\r\n\r\n        mw.TimeUtil.onEnterFrame.remove(this.renderAnimHandler);\r\n\r\n        return this;\r\n    }\r\n\r\n//#region CallBack\r\n    public onClick: SimpleDelegate<ClickEvent> = new SimpleDelegate();\r\n\r\n//#endregion ⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠐⠒⠒⠒⠒⠚⠛⣿⡟⠄⠄⢠⠄⠄⠄⡄⠄⠄⣠⡶⠶⣶⠶⠶⠂⣠⣶⣶⠂⠄⣸⡿⠄⠄⢀⣿⠇⠄⣰⡿⣠⡾⠋⠄⣼⡟⠄⣠⡾⠋⣾⠏⠄⢰⣿⠁⠄⠄⣾⡏⠄⠠⠿⠿⠋⠠⠶⠶⠿⠶⠾⠋⠄⠽⠟⠄⠄⠄⠃⠄⠄⣼⣿⣤⡤⠤⠤⠤⠤⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄\r\n}\r\n\r\nexport type AvatarVariant = \"square\" | \"circle\";\r\n\r\nexport interface AvatarOption extends ComponentOption<number> {\r\n    /**\r\n     * 标签 文本.\r\n     * @desc 与 labelIcon 互斥.\r\n     * @desc labelIcon 优先生效.\r\n     */\r\n    labelText?: string;\r\n\r\n    /**\r\n     * 标签 图标.\r\n     * @desc 与 labelText 互斥.\r\n     * @desc labelIcon 优先生效.\r\n     */\r\n    labelIcon?: string;\r\n\r\n    color?: ThemeColor;\r\n\r\n    fontSize?: Property.FontSize;\r\n\r\n    fontStyle?: Property.FontStyle;\r\n\r\n    variant?: AvatarVariant;\r\n\r\n    /**\r\n     * 遮罩精度.\r\n     * @desc 过高将带来性能问题.\r\n     * @desc 过低将影响性能.\r\n     * @desc 默认值为 6.\r\n     */\r\n    effectLevel?: Property.EffectLevel;\r\n}\r\n"],"names":[],"mappings":"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"}